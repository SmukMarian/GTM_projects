# GTM-этапы: концепт редизайна (2 варианта + компактные задачи)

Цель: сделать представления этапов/задач максимально плотными, визуально выразительными и быстрыми для работы. Ниже — два варианта (карточный и табличный) и набор улучшений для компактного списка задач. Канбан остаётся как есть, только подтягиваем единый визуальный язык.

## Общие принципы
- **Фокус на прогрессе и рисках.** Любой экран должен сразу показывать % завершения, SLA по срокам, блокеры и приоритеты.
- **Супер-быстрое редактирование.** Почти всё редактируется инлайн без модалок: статус, даты, ответственный, приоритет, теги, подзадачи.
- **Глубина по требованию.** Карточки/строки по умолчанию компактны; подробности разворачиваются аккордеоном с мягкой анимацией.
- **Чёткий визуальный язык.** Цвета статусов, тонкие прогресс-бары, стейт-бейджи (Риск, Блокер, Просрочено, В ожидании), иконки действий в одной строке.
- **Счётчики «живые».** Сразу видно задачи, подзадачи, комментарии; клики по счётчикам открывают соответствующий список сбоку (правый сайдбар).

---

## Вариант A — «Карточный трек» (mobile-friendly)
Карточки этапов складываются в вертикальный трек; каждая карточка — мини-дэшборд.

### Внешний вид
- Шапка: название этапа + бейдж статуса (Не начат / В работе / Риск / Просрочено / Готово), справа — дата план/факт с цветовым кодом.
- Под шапкой: тонкий **timeline-progress** (план → сегодня → факт) с точками и подписью дня срыва/буфера.
- Блок метрик: `Прогресс %`, `Задач`, `Подзадач`, `Комментариев`, `Риски`. Каждый — компактный бейдж с иконкой.
- Зона задач: список задач с чекбоксами, цветной полоской приоритета слева, бейджем срока, и мини-баром прогресса подзадач. Аккордеон для подзадач.
- Панель действий: иконки «плей/пауз» статуса, «комментарий», «риск», «контекстное меню», «перетащить». На hover появляются подсказки.

### UX-детали
- **Разворот по клику на строку задачи** → подзадачи выпадают в виде чек-листа с быстрым добавлением (input + Enter).
- **Инлайн-редактирование дат**: date-pill открывает date-picker прямо в строке; изменение сразу пересчитывает SLA-цвет.
- **Риск-лента**: если задача/этап в риске, сверху карточки появляется узкая лента (accent-amber) с текстом блокера.
- **Микро-анимации:** прогресс-бары и бейджи статуса плавно анимируются при изменении; паддинг уменьшен для плотности.

### Реализация (Codex)
1. **Структура**: внутри `templates.html` или отдельного `components/stages-card.html` — компонент `StageCard` с пропсами `{ stage, tasks, onUpdate }`.
2. **Layout**: CSS grid 1 колонка (mobile) / 2 колонки (>=1200px). Карточка — контейнер с header, progress, metrics, tasks-list.
3. **Progress timeline**: горизонтальный div с псевдоэлементами для точек; класс по состоянию (`.is-late`, `.is-risk`).
4. **Metrics chips**: flex-wrap, тёмный текст, фон `var(--surface-2)`, иконки из `theme.js` / SVG-спрайта.
5. **Tasks list**: ul с `data-draggable`; левая цветная линия по приоритету (CSS `border-inline-start`), бейдж даты (`.pill pill--due`), чекбоксы стилизованные.
6. **Подзадачи**: детали внутри `<details>`; добавление — inline form, обновление статуса — через чекбокс с instant-save.
7. **Actions**: иконки-кнопки в единой линии, hover/active стейты; aria-label для доступности.
8. **Сайдбар**: при клике на счётчик комментариев/рисков открывать правую панель (`position: sticky; width: 360px`) с списком комментариев/рисков.

---

## Вариант B — «Data Grid Pro» (таблица)
Плотная таблица с фиксированными колонками и быстрыми фильтрами.

### Внешний вид
- Две фиксированные колонки: `Этап` (с цветной точкой статуса) и `Задача` (иконка приоритета). Остальные горизонтально скроллятся при переполнении.
- Верхняя панель фильтров: быстрые тэги «Просрочено», «Риск», «Скоро дедлайн (7д)», «Без подзадач», «Мои». Чипы с подсчётом.
- Колонки: Статус (дропдаун-бейдж), Срок план/факт, Прогресс (микробар), Подзадачи %/число, Комментарии (иконка+число), Риск (иконка+текст), Приоритет, Действия.
- Строка задачи раскрывается на +1 уровень прямо под ней (inline subrow) для подзадач с чек-листом и кнопкой «+».
- Sticky footer с суммарными метриками: всего задач, просрочено, в риске, готово.

### UX-детали
- **Инлайн-редактирование**: клики по ячейкам Статус/Дата/Приоритет открывают селект/датапикер без модалок.
- **Горячие клавиши**: ↑/↓ перемещают выделение, `E` — редактировать статус, `D` — редактировать дату, `Space` — отметить задачу готовой.
- **Умный скролл**: горизонтальный скролл синхронизируется с тенью/градиентом по краям, чтобы было понятно, что таблица скроллится.
- **Подсветка сроков**: даты получают фон по SLA (зелёный / жёлтый / красный); лейбл «Сегодня» — яркий.

### Реализация (Codex)
1. **Структура**: новый шаблон `templates-stages-table.html` или секция в `templates.html` с `TableStageView`.
2. **Grid**: использовать CSS `display: grid` для хедера (fixed) и `div`-строк для тела, чтобы легко фиксировать первые колонки (`position: sticky; left: 0`).
3. **Row grouping**: группировать по этапу (row group header с прогрессом этапа) → под ним строки задач.
4. **Inline editors**: реализовать ячейки как кнопки, по клику заменять на `<select>`/`<input type="date">`; сохранять по blur/Enter.
5. **Micro-progress**: узкий бар внутри ячейки Прогресс; текстовое значение справа (например, `64%`).
6. **Subrow**: при клике раскрытия вставлять под строкой div с чек-листом подзадач; поддержать клавишу `Tab` для добавления новой подзадачи.
7. **Keyboard nav**: повесить обработчики на контейнер таблицы; хранить `data-row`/`data-col` индексы для перемещения.

---

## Компактный список задач (режим "Компактные задачи")
Улучшения для both таблицы и компактного списка, сохраняя канбан как есть (только единый стиль бейджей/цветов).

- **Резюмирующая шапка**: слева фильтры-чипы (Приоритет, Статус, Срок), справа — быстрый поиск по названию/комментариям.
- **Мини-карточки**: каждая задача в компактном списке — одна строка с цветной полосой приоритета, бейджем срока, маленьким прогресс-баром подзадач, кнопками статуса и комментариев.
- **Быстрые действия**: иконки «статус», «срок», «коммент», «риск», «контекстное меню» в конце строки (скрываются до hover на десктопе).
- **Чёткая типографика**: основной текст 14–15px, мета-инфо 12px muted, межстрочный паддинг 8–10px для высокой плотности.
- **Скрытие шума**: пустые поля (нет подзадач/комментариев) отображаются серым `—`, без пустых строк.
- **Фиксированные колонки в таблице компактных задач**: название и статус закреплены, остальное скроллится.
- **Единые цвета и бейджи** для табличного и канбан-режима, чтобы переключение режима не ломало восприятие.

### Реализация (Codex)
1. **Compact row компонент**: создать `CompactTaskRow` (в `templates.html`) с пропсами `{ task, onUpdate }`; переиспользовать в таблице и списке.
2. **Стили**: добавить токены цветов для статусов/приоритетов в `theme.js`; полоска приоритета через `::before` с шириной 4px.
3. **Фильтры-чипы**: горизонтальный scrollable контейнер; активные чипы подсвечены, клики триггерят фильтр функций существующих таблиц/канбана.
4. **Инлайн-редактирование**: статус и срок кликабельны прямо в строке; сохранять через существующий API без модалок.
5. **Hover actions**: иконки действий появляются при наведении (desktop) или через свайп/долгое удержание (mobile hint).
6. **Shared badge set**: вынести стили бейджей (статус, срок, риск) в единый CSS-модуль, применить и в канбане.

### Статус внедрения
- [x] Добавлены фильтры-чипы по статусам/срокам/флагам и поиску прямо над компактным списком задач.
- [x] Переработаны строки таблицы: цветная полоска приоритета, бейдж этапа/срока, микропрогресс по подзадачам.
- [x] Канбан и таблица используют единый набор бейджей сроков/статусов для непрерывного восприятия.
- [x] Инлайн-редактирование статусов/сроков из строки без модалок.
- [x] Выделенное переиспользуемое ядро `CompactTaskRow` для всех видов списка.

### Статус внедрения по этапам
- [x] Карточки этапов получили таймлайн по плану/сегодня, метрики прогресса, подзадач и комментариев.
- [x] Добавлены быстрые фильтры этапов (риск/просрочка/7 дней) с суммарной строчкой.
- [x] Таблица этапов обновлена: фиксированные первые колонки, бейджи сроков, микропрогресс и состояния рисков.

---

## Что получаем
- Максимальная плотность информации без перегруза: статус, сроки, риски и прогресс видны сразу.
- Быстрота работы: инлайн-редактирование, горячие клавиши в таблице, мгновенные сайдбары для комментариев/рисков.
- Визуальная премия: чистые карточки с timeline, data-grid с микробарами и липкими колонками, единый цветовой язык.
