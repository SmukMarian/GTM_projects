# fix.md — идеальный фикс (UI/UX + баги). Интегрировано с лучшими идеями "Depth & Air"
Версия: 2025‑11‑21  
Цель: привести интерфейс Projects Tracker к уровню “премии года по дизайну” **без поломки текущей архитектуры**.  
Области:  
1) GTM‑этапы / задачи / подзадачи (Cards + Table)  
2) Компактный список задач (Table + Kanban)  
3) Управление характеристиками (стили, шаблоны, таблицы)  
4) Модалки “Новый проект / Новая группа” и в целом все Pop‑up  
5) Фильтры по кастомным полям (проекты/группы)

---

## 0) НЕ ТРОГАТЬ АРХИТЕКТУРУ (жёсткий контракт)

1. **Нельзя изменять схемы данных, API, localStorage‑ключи, имена функций.**  
2. **Запрещено переименовывать/удалять существующие id и data‑атрибуты.**  
3. Разрешено:
   - добавлять новые CSS‑классы и переменные;
   - добавлять wrapper‑div внутри существующих блоков **без изменения id**;
   - править HTML‑шаблоны внутри render‑функций **без изменения их сигнатур**;
   - добавлять новые мелкие helper‑функции (без вмешательства в storage/API).

---

## 1) Дизайн‑система “Depth & Air 2026” (локально и безопасно)

**Идея:** меньше тяжёлых рамок, больше воздуха, мягкие слои, но **с жёсткой сеткой**, чтобы интерфейс не “плыл”.

### 1.1. Токены (CSS variables)
- [x] Добавить Depth & Air переменные в `:root`.

### 1.2. Базовые правила компонентов (без глобального width!)
- [x] Убрать глобальный `width:100%` у input/select/textarea.
- [x] Добавить фокус/тени и фон через токены.
- [x] Полная ширина только через контейнеры `.form-grid`, `.char-field-grid`, `.gtm-inline-edit`, `.stage-row-edit`.

### 1.3. Карточки/секции
- [x] Карточки/секции на базе `--radius-l`, `--shadow-s` с hover `--shadow-m`.

---

## 2) Модалки и Pop‑up: убрать налезание полей

- [x] Грид `.form-grid` с колонками min 260px, без глобальных width на инпутах.
- [x] Аудит всех модалок: поля не должны наезжать, локально задать ширины где нужно.

---

## 3) Управление характеристиками

- [x] Для формы “Новое поле” применить `.char-field-grid`, двухколоночные RU/EN, тип поля на новой строке.
- [x] Всегда обновлять select шаблонов после load/save/delete/import.
- [x] Действия таблицы полей — иконками (ширина 120–140px).

---

## 4) GTM‑этапы — премиальный компактный UX

### 4.1. Этапы — Cards view
- [x] Корневой DOM: `section.gtm-stage-card > header.gtm-stage-header + .gtm-stage-body + .gtm-stage-tasks`.
- [x] Header: индекс, название, статус/риск, сроки в одну строку + мини‑прогресс и иконки действий.
- [x] Метрики этапа — строка чипов без плиток.
- [x] Быстрые действия в одну компактную строку.
- [x] Карточка: радиусы, мягкая тень, margin 10px.

### 4.2. Этапы — Table view
- [x] View режим без инпутов, edit через `editingStageId` и `enterStageEdit/exitStageEdit`.
- [x] Высота строк 44–48px, плотный паддинг.
- [x] Действия только иконками, фикс ширины.

---

## 5) Задачи внутри этапа — однострочные “task rows”
- [x] Строка задачи: toggle подзадач, статус-чип, название/подописание в одну линию, мета справа, иконки действий.
- [x] Line2/мета показывается только при наличии данных.
- [x] Подзадачи рендерятся в `subtask-panel`, раскрытие по toggle, одна строка с чекбоксом/иконками.

---

## 6) Подзадачи
- [x] Размещены в `subtask-panel`, сортировка по order, чекбоксы, редактирование/удаление и инлайн-добавление.

---

## 7) Компактный список задач (Table)
- [x] colgroup с фиксами ширины: задача 320+, статус 120, этап 200, важность/срочность 110, срок 160, подзадачи 110, действия 120.
- [x] Убедиться что строка 44px и действия иконками везде.

---

## 8) Фильтры по кастомным полям (проекты/группы)
- [x] Кнопка “Фильтры” (funnel) рядом с поиском, открывает drawer.
- [x] Видимость поля если привязано >1 сущности; фильтры по типу (text/number/select/bool) с логикой из ТЗ.

---

## 9) Порядок внедрения

1. CSS‑аудит width (п.2).
2. Characteristics (п.3).
3. Фильтры кастом‑полей (п.8).
4. GTM (п.4‑6), потом compact tasks (п.7).
5. Регресс.

---

## 10) Acceptance checklist

- [x] Модалки: поля не налезают.
- [x] Этап collapsed ≤2 строк, header + чипы.
- [x] Задачи 1 строка, meta строка, подзадачи раскрываются.
- [x] Архитектура не сломана, id/классы сохранены.
- [x] Compact tasks table ровная, sticky/width соблюдены.
