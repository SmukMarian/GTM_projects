# fix.md — TECH SPEC v2 (GTM stages/tasks UI + compact tasks list + global width cleanup)
Отмечай выполненные пункты, заменяя `[ ]` на `[x]`.

Цель: дать **максимально техничное ТЗ**, чтобы Codex не “поплыл”.
Фокус: сделать GTM-этапы/задачи/подзадачи и “Компактные задачи” **ультра-компактными, сканируемыми, на уровне топ-продукта**, без поломки архитектуры.

Ограничения:
- НЕ менять API, модели данных, имена ключей, существующие id/классы/пропсы.
- НЕ удалять текущие компоненты. Только локальные правки рендера/стилей.
- Никаких глобальных `input/select/textarea { width:100% }`.
- Все новые стили строго под неймспейсом: `.gtm-*`, `.tasks-*`, `.modal-*`.

---

## 0. Глобальные регрессы формы (критично)
### 0.1 Убрать глобальный `width:100%`
- [x] Найти ВСЕ правила в global css типа:
  ```css
  input, textarea, select { width: 100%; }
  ```
  и удалить `width`.
- [x] Оставить глобально только безопасные свойства (border, padding, font, radius).
- [x] `width:100%` задавать **только локально** контейнерами форм.

**Патч-образец:**

```css
/* global */
input,textarea,select{
  border:1px solid var(--border);
  border-radius:12px;
  padding:8px 10px;
  font:inherit;
  /* width removed */
}

/* local full-width */
.modal-form input,
.modal-form textarea,
.modal-form select,
.gtm-inline-edit input,
.gtm-inline-edit select,
.gtm-inline-edit textarea{
  width:100%;
  min-width:0;
  box-sizing:border-box;
}
```

### 0.2 Приёмка модалок

* [ ] Проверить модалки “Новый проект”, “Новая продуктовая группа” и др.
* [ ] Нигде поля не должны наезжать/вылезать.
* [ ] Если где-то нужна ширина — править локально.

---

## 1. GTM-этапы — режим “Карточки”

### 1.1 Контейнер этапа: строгая структура DOM
- [x] Привести рендер к этой структуре (без удаления логики).

### 1.2 Header этапа — одна строка, сканируемая
- [x] В шапке этапа разместить номер, название, статус, риск, сроки и иконки действий в одну строку.

### 1.3 Метрики этапа — только чип-строка
- [x] Удалить большие блоки-плитки метрик из карточек и заменить строкой чипов.

### 1.4 “Быстрые действия” этапа — одна компактная строка
- [x] Убрать правые тяжёлые панели, оставить статус-select, риск-чекбокс и кнопку “+ Задача” в одну строку.

### 1.5 Карточка этапа — компактная высота, спокойный фон
- [x] Карточка с мягкой тенью, радиусом 16px, отступами 8–10px и margin между этапами ≥10px.

---

## 2. Задачи внутри этапа (карточный список)

### 2.1 DOM задачи
- [x] Использовать структуру `.gtm-task-row` с блоками left/right.

### 2.2 Line1 задачи — строго одна строка
- [x] Статус-чип + название (ellipsis) + короткий сабтайтл в одной строке.

### 2.3 Line2 (опционально) — мета-строка
- [x] Показывать только при наличии данных (срок, прогресс) и без пустых мест.

### 2.4 Действия задачи — только иконки
- [x] Оставить только иконки (edit/comments/toggle/delete) в правой колонке.

---

## 3. GTM-этапы — режим “Таблица”

### 3.1 View-режим по умолчанию
- [x] В таблице инпуты/селекты показывать ТОЛЬКО для строки `editingStageId`.

### 3.2 Таблица: фикс-layout и плотность
- [x] `table-layout: fixed`, высота строки ~44px, вертикальное выравнивание по центру.

### 3.3 Колонка действий
- [x] Фикс ширина 140–160px, только иконки без крупных кнопок.

---

## 4. “Компактный список задач” — таблица

### 4.1 Сводка = одна строка чипов
- [x] Сводку сверху оставить в один ряд чипов с кнопкой сворачивания.

### 4.2 Таблица задач плотная
- [x] Плотные строки 40–44px, фиксированный layout.

### 4.3 Ячейка “Задача”
- [x] 1 строка — название (bold, ellipsis); 2 строка — `этап • срок` muted.

### 4.4 Действия в компактных задачах
- [x] Только иконки, размер как `.icon-btn`.

---

## 5. Канбан компактных задач

- [ ] Логику не трогать; визуально — те же радиусы/чипы, что и в GTM-задачах.

---

## 6. Приёмка (жёсткие критерии)

### GTM-карточка этапа
- [x] Header этапа занимает **1 строку** (чипы допускается переносить, кнопки — нет).
- [x] Метрики — только чип-ряд, без больших плиток.
- [x] Нет правых тяжёлых блоков.
- [x] Между этапами есть `margin-top/bottom >= 10px`.

### Задачи этапа
- [x] Line1 всегда помещается в одну строку, название + подописание с `ellipsis`.
- [x] Line2 появляется только при наличии данных.
- [x] Иконки действий не увеличивают высоту строки.

### GTM-таблица
- [x] Нет постоянных инпутов.
- [x] Высота строки 44px.
- [x] Колонка “Действия” не раздувает таблицу.

### Модалки/формы
- [ ] После удаления глобального `width:100%` все поля в модалках корректны.
